---
import BaseLayout from '../../layouts/BaseLayout.astro';
import ContactCTA from '../../components/ContactCTA.astro';
import Hero from '../../components/Hero.astro';
import Grid from '../../components/Grid.astro';

import { Octokit } from "octokit";
export const getStaticPaths = async () => {
    const octokit = new Octokit({
        auth: import.meta.env.GITHUB_TOKEN
    });

    const {data} =  await octokit.request('GET /users/cornatul/gists', {
        headers: {
            'X-GitHub-Api-Version': '2022-11-28'
        }
    })

    const paths = data.map((gist) => (
        console
        {

            params: {
                id: gist.id
            }
        }
    ));


    return [
        {
            paths,
            fallback: false
        }
    ];
};
export const getStaticProps = async ({ params }) => {
    const octokit = new Octokit({
        auth: import.meta.env.GITHUB_TOKEN
    });
    const { data } = await octokit.request('GET /gists/{gist_id}', {
        gist_id: params.id
    });

    const content = Object.values(data.files)[0].content;

    return {
        props: {
            title: data.description,
            content
        }
    };
};
---

<BaseLayout title="Blog" description="My thogts on technology and more">
    <div class="stack gap-20">
        <main class="wrapper stack gap-8">
            <Hero title="Blog" />
            <Grid>
                <div class="stack gap-4">
                    <h1>{title}</h1>
                    <div class="markdown">
                        {content}
                    </div>
                </div>
            </Grid>
        </main>
        <ContactCTA />
    </div>
</BaseLayout>
